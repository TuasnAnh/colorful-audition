{"version":3,"sources":["system/BgRenderSystem.js","system/ArrowButtonRenderSystem.js","system/InputHandlerGameScreenSystem.js","system/ButtonRenderSystem.js","system/BarDurationRenderSystem.js","system/HandAnimationRenderSystem.js","components/orthoCamera2.js","system/CurtainRenderSystem.js","utils/coordUtils.js","screen/EndScreen.js","screen/GameScreen.js","data.js","createWorld.js","screen/StartScreen.js","components/xml2json.js","components/loadSCML.js","components/textureRegion.js","components/loadJsonAtlas.js","loadSpriter.js","index.js"],"names":["createBackGroundRenderSystem","tableInfos","backGroundInfos","init","worldState","width","atlas","height","assets","auditionAtlas","table","findRegion","TABLE_WIDTH","TABLE_HEIGHT","tex","w","h","bg","BG_WIDTH","BG_HEIGHT","update","delta","boundaryY","batch","camera","setProjection","combined","begin","setColor","draw","end","createRenderArrowButtonSystem","finishTex","starEffect","SE_WIDHT","SE_HEIGHT","buttonTex","buttonRect","finishRect","scaleButton","scaleFinish","finishAtlas","upButton","downButton","leftButton","rightButton","upButtonPress","downButtonPress","leftButtonPress","rightButtonPress","finishButton","FINISH_WIDTH","FINISH_HEIGHT","BUTTON_WIDTH","BUTTON_HEIGHT","horizonalMargin","BUTTON_START_LEFT_X","BUTTON_START_LEFT_y","x","y","unpress","press","whiteTex","finishedPhase","newPhase","Math","max","min","scale1","opacity1","scale2","opacity2","i","length","keyActivated","activateKey","key","deactivateKey","checkHitRight","type","notes","phaseIndex","currentCheckingNoteIndex","activated","zoomOutNoteIndexs","push","createInputHandleGameScreenSystem","rectTouches","coord","Vector2","canvas","pixelRatio","inputHandler","addEventListener","id","setVector","getTouchedWorldCoord","rectIndex","rect","getRectContainPoint","getRectPassButtonPoint","canPassPhase","hit","miss","anim","animIndex","missAnim","hitFinishButton","document","e","which","createButtonRenderSystem","downBtn","upBtn","leftBtn","rightBtn","downBtnGray","upBtnGray","leftBtnGray","rightBtnGray","active","passive","noteInfos","zoomOutNoteInfos","currentNotesPhase","currentNotesInfos","index","scale","postion","splice","note","createDurationRenderSystem","finishBar","finishMark","finishMetter","markEffect","durationZone","BAR_WIDTH","METTER_WIDTH","MARK_WIDTH","ME_WIDTH","ME_HEIGHT","cool","great","perfect","textList","textListInfos","finishBarInfos","finishMetterInfos","finishMarkInfos","COOL_H","COOL_W","GREAT_H","GREAT_W","PERFECT_H","PERFECT_W","MISS_H","MISS_W","BAR_HEIGHT","BAR_START_X","MARK_HEIGHT","METTER_HEIGHT","stateTime","realTimeDurationSet","durationEachPhase","texture","scoreType","centerTime","minTime","infos","checkScoreType","textPopUp","startY","opacity","finishMarkEffect","createHandAnimationRenderSystem","offsetX","offsetY","DRAW_WIDTH","DRAW_HEIGHT","animOffset","buom_bay_right","xoa_tay","buom_bay_left","choang_nhau","tinh_ban","ca_sau","spriter","resizeCanvas","cWidth","cHeight","viewportWidth","viewportHeight","mat4","create","transform","invOrtho","lookAtMatrix","position","tmp3","eye","center","up","ortho","identity","lookAt","mul","invert","setMatrix","mat","copy","setYUp","yUp","setPosition","unprojectVector2","out","input","unproject","set","resize","newWidth","newHeight","createOrthoCamera2","getAspect","setEntity","setAnim","offset","getAnim","createCurtainRenderSystem","curtainInfors","curtain","CURTAIN_WIDTH","CURTAIN_HEIGHT","fillRect","checkPointInsideRect","point","verts","DEVICE_PIXEL_RATIO","minX","maxX","minY","maxY","createRenderEndScreenSystem","Game","goToStartScreen","a","createRenderStartScreenSystem","setCurrentScreen","viewport","createViewportAwareInputHandler","startEndAtlas","restartButton","quote","yourScore","percentage","RB_WIDTH","RB_HEIGHT","RB_START_X","RB_START_Y","Q_WIDHT","Q_HEIGHT","YS_WIDTH","YS_HEIGH","number0","number1","number2","number3","number4","number5","number6","number7","number8","number9","NB_HEIGHT","numberInfos","percentageInfos","numberList","sumLength","START_X","distanceTmp","caculateString","result","char","charAt","parseInt","getStringInfos","completePercentage","toString","destroy","cleanup","gl","sound","lines","split","value","map","s","trim","start","duration","restTime","nodes","play","scripts","tmpArray","floor","random","NOTE_SIZE","NOTE_MARGIN","NOTE_START_Y","NOTE_RECTS","NOTE_Y","NOTE_X","j","noteI","abs","gameOver","buttonInfos","durationBarInfos","world","extra","systems","passiveSystems","addSystem","system","runPassive","createWorld","goToEndScreen","timeAccumulate","counter","firstRun","startButton","NB1_HEIGHT","NB1_WIDHT","NB2_HEIGHT","NB2_WIDHT","NB3_HEIGHT","NB3_WIDHT","startCountDown","goToGameScreen","createRenderGameScreenSystem","xml","tab","X","toObj","o","nodeType","attributes","nodeName","nodeValue","firstChild","textChild","cdataChild","hasElementChild","n","nextSibling","match","removeWhite","escape","Array","innerXml","documentElement","alert","toJson","name","ind","json","join","arr","m","node","innerHTML","asXml","c","txt","replace","normalize","nxt","removeChild","packFileUrl","regionNames","spriter_data","fetch","then","res","text","packFileContent","parser","DOMParser","xml_text","parseFromString","json_text","xml2json","JSON","parse","spriter_json","Data","load","folder_array","forEach","folder","file_array","file","fileIndex","pose","Pose","data","rawData","TextureRegion","originX","originY","extraData","invTexWidth","invTexHeight","u","v","u2","v2","this","rotated","cols","rows","regionWidth","regionHeight","regions","rotation","scaleX","scaleY","concatAndResolveUrl","url","concat","url1","url2","url3","l","pop","loadUrl","textureOptions","textureRegions","sites","obj","meta","Object","getOwnPropertyNames","frames","framesArray","keys","image","frame","site","rotate","offset_x","spriteSourceSize","offset_y","original_w","sourceSize","original_h","region","trimmed","app","format","main_texture","size","version","loadTexture","invTextWidth","invTextHeight","listPackFileUrl","isArray","getRegions","scmlUrl","rectName","loadSCML","atlasInfos","transformMatrix","vertices","Float32Array","arr1","arr2","arr3","arr4","xy1","xy2","xy3","xy4","loadJsonAtlas","info","setArr","v1","v3","v4","v5","generateVertices","affine","color","translate","rotateZ","rad","vec3","transformMat4","domain","range","getInfos","rectObject","strike","entityKey","entity","entity_map","obj_info_map","px","object_array","find","world_space","py","pw","ph","prevX","prevY","prevW","prevH","nudged","estimate","folder_index","file_index","drawVertices","getElementById","window","devicePixelRatio","createViewport","getContext","getCamera","createBatch","createWhiteText","Howl","src","screen","currentScreen","loadSpriter","loadAtlas","clearColor","clear","COLOR_BUFFER_BIT","createGameLoop"],"mappings":"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","file":"static/js/main.1ddd9fb0.chunk.js","sourcesContent":["const createBackGroundRenderSystem = () => {\r\n  let tableInfos = {};\r\n  let backGroundInfos = {};\r\n  return {\r\n    init(worldState, { width, height, assets }) {\r\n      let atlas = assets.auditionAtlas;\r\n      const table = atlas.findRegion(\"table\", -1);\r\n      const TABLE_WIDTH = width;\r\n      const TABLE_HEIGHT = (TABLE_WIDTH * table.height) / table.width;\r\n      tableInfos = { tex: table, w: TABLE_WIDTH, h: TABLE_HEIGHT };\r\n\r\n      const bg = atlas.findRegion(\"bg\", -1);\r\n      const BG_WIDTH = width;\r\n      const BG_HEIGHT = (BG_WIDTH * bg.height) / bg.width;\r\n      backGroundInfos = { tex: bg, w: BG_WIDTH, h: BG_HEIGHT };\r\n    },\r\n    update(delta, { boundaryY }, { batch, width, height, camera }) {\r\n      batch.setProjection(camera.combined);\r\n      batch.begin();\r\n      batch.setColor(1, 1, 1, 1);\r\n      backGroundInfos.tex.draw(\r\n        batch,\r\n        width / 2 - backGroundInfos.w / 2,\r\n        -backGroundInfos.h / 30,\r\n        backGroundInfos.w,\r\n        backGroundInfos.h\r\n      );\r\n\r\n      tableInfos.tex.draw(\r\n        batch,\r\n        width / 2 - tableInfos.w / 2,\r\n        boundaryY,\r\n        tableInfos.w,\r\n        tableInfos.h\r\n      );\r\n\r\n      batch.end();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createBackGroundRenderSystem;\r\n","// import { fillRect } from \"gdxjs\";\r\n\r\nconst createRenderArrowButtonSystem = () => {\r\n  let buttonTex = [];\r\n  let buttonRect = [];\r\n  let finishRect = {};\r\n  let finishTex;\r\n  let starEffect, SE_WIDHT, SE_HEIGHT;\r\n  let scaleButton = 1;\r\n  let scaleFinish = 0.4;\r\n  return {\r\n    init(worldState, { width, height, assets }) {\r\n      const atlas = assets.auditionAtlas;\r\n      const finishAtlas = assets.finishAtlas;\r\n      const upButton = atlas.findRegion(\"up\", -1);\r\n      const downButton = atlas.findRegion(\"down\", -1);\r\n      const leftButton = atlas.findRegion(\"left\", -1);\r\n      const rightButton = atlas.findRegion(\"right\", -1);\r\n      const upButtonPress = atlas.findRegion(\"up-press\", -1);\r\n      const downButtonPress = atlas.findRegion(\"down-press\", -1);\r\n      const leftButtonPress = atlas.findRegion(\"left-press\", -1);\r\n      const rightButtonPress = atlas.findRegion(\"right-press\", -1);\r\n      const finishButton = atlas.findRegion(\"finish_press\", -1);\r\n\r\n      starEffect = finishAtlas.findRegion(\"finish_start_effect\", -1);\r\n\r\n      SE_WIDHT = width / 8;\r\n      SE_HEIGHT = (SE_WIDHT * starEffect.height) / starEffect.width;\r\n\r\n      const FINISH_WIDTH = width / 4;\r\n      const FINISH_HEIGHT =\r\n        (FINISH_WIDTH * finishButton.height) / finishButton.width;\r\n\r\n      const BUTTON_WIDTH = width / 5;\r\n      const BUTTON_HEIGHT = (BUTTON_WIDTH * upButton.height) / upButton.width;\r\n\r\n      const horizonalMargin = BUTTON_WIDTH * 0.8;\r\n      const BUTTON_START_LEFT_X =\r\n        (width - (BUTTON_WIDTH * 2 + horizonalMargin)) / 2;\r\n      const BUTTON_START_LEFT_y = (height * 3.95) / 5;\r\n\r\n      finishTex = finishButton;\r\n      finishRect = {\r\n        x:\r\n          BUTTON_START_LEFT_X +\r\n          BUTTON_WIDTH +\r\n          horizonalMargin / 2 -\r\n          FINISH_WIDTH / 2,\r\n        y: BUTTON_START_LEFT_y + BUTTON_HEIGHT / 2 - FINISH_HEIGHT / 2,\r\n        width: FINISH_WIDTH,\r\n        height: FINISH_HEIGHT,\r\n      };\r\n\r\n      buttonTex = [\r\n        { unpress: leftButton, press: leftButtonPress },\r\n        { unpress: upButton, press: upButtonPress },\r\n        { unpress: rightButton, press: rightButtonPress },\r\n        { unpress: downButton, press: downButtonPress },\r\n      ];\r\n      buttonRect = [\r\n        {\r\n          x: BUTTON_START_LEFT_X,\r\n          y: BUTTON_START_LEFT_y,\r\n          width: BUTTON_WIDTH,\r\n          height: BUTTON_HEIGHT,\r\n        },\r\n        {\r\n          x: BUTTON_START_LEFT_X + BUTTON_WIDTH / 2 + horizonalMargin / 2,\r\n          y: BUTTON_START_LEFT_y - BUTTON_HEIGHT * 0.8,\r\n          width: BUTTON_WIDTH,\r\n          height: BUTTON_HEIGHT,\r\n        },\r\n        {\r\n          x: BUTTON_START_LEFT_X + BUTTON_WIDTH + horizonalMargin,\r\n          y: BUTTON_START_LEFT_y,\r\n          width: BUTTON_WIDTH,\r\n          height: BUTTON_HEIGHT,\r\n        },\r\n        {\r\n          x: BUTTON_START_LEFT_X + BUTTON_WIDTH / 2 + horizonalMargin / 2,\r\n          y: BUTTON_START_LEFT_y + BUTTON_HEIGHT * 0.8,\r\n          width: BUTTON_WIDTH,\r\n          height: BUTTON_HEIGHT,\r\n        },\r\n      ];\r\n\r\n      worldState.buttonRect = buttonRect;\r\n      worldState.finishRect = finishRect;\r\n    },\r\n    update(delta, worldState, { batch, camera, width, height, whiteTex }) {\r\n      batch.setProjection(camera.combined);\r\n      batch.begin();\r\n      batch.setColor(1, 1, 1, 1);\r\n\r\n      // console.log(worldState.newPhase);\r\n      if (worldState.finishedPhase && !worldState.newPhase) {\r\n        scaleButton = Math.max(0.7, (scaleButton -= delta * 2));\r\n        scaleFinish = Math.min(1, (scaleFinish += delta * 4));\r\n      } else if (!worldState.finishedPhase || worldState.newPhase) {\r\n        scaleButton = Math.min(1, (scaleButton += delta * 2));\r\n        scaleFinish = Math.max(0.4, (scaleFinish -= delta * 4));\r\n      }\r\n\r\n      if (worldState.finishedPhase) {\r\n        // start effect\r\n        worldState.starEffect.scale1 += (delta * 47) / 3;\r\n        batch.setColor(1, 1, 1, worldState.starEffect.opacity1);\r\n        starEffect.draw(\r\n          batch,\r\n          finishRect.x + finishRect.width / 2 - SE_WIDHT / 2,\r\n          finishRect.y + finishRect.height / 2 - SE_HEIGHT / 2,\r\n          SE_WIDHT,\r\n          SE_HEIGHT,\r\n          SE_WIDHT / 2,\r\n          SE_HEIGHT / 2,\r\n          0,\r\n          worldState.starEffect.scale1,\r\n          worldState.starEffect.scale1\r\n        );\r\n        batch.setColor(1, 1, 1, 1);\r\n        if (worldState.starEffect.scale1 >= 4) {\r\n          worldState.starEffect.scale2 += (delta * 47) / 3;\r\n          batch.setColor(1, 1, 1, worldState.starEffect.opacity2);\r\n          starEffect.draw(\r\n            batch,\r\n            finishRect.x + finishRect.width / 2 - SE_WIDHT / 2,\r\n            finishRect.y + finishRect.height / 2 - SE_HEIGHT / 2,\r\n            SE_WIDHT,\r\n            SE_HEIGHT,\r\n            SE_WIDHT / 2,\r\n            SE_HEIGHT / 2,\r\n            0,\r\n            worldState.starEffect.scale2,\r\n            worldState.starEffect.scale2\r\n          );\r\n          batch.setColor(1, 1, 1, 1);\r\n        }\r\n        worldState.starEffect.scale1 = Math.min(\r\n          6,\r\n          worldState.starEffect.scale1\r\n        );\r\n        if (worldState.starEffect.scale1 === 6) {\r\n          worldState.starEffect.opacity1 = Math.max(\r\n            0,\r\n            (worldState.starEffect.opacity1 -= delta * 5)\r\n          );\r\n        }\r\n\r\n        worldState.starEffect.scale2 = Math.min(\r\n          6,\r\n          worldState.starEffect.scale2\r\n        );\r\n        if (worldState.starEffect.scale2 === 6) {\r\n          worldState.starEffect.opacity2 = Math.max(\r\n            0,\r\n            (worldState.starEffect.opacity2 -= delta * 5)\r\n          );\r\n        }\r\n        // if (worldState.starEffect.opacity2 === 0) {\r\n        //   // worldState.hitFinishButton = false;\r\n        //   // worldState.newPhase = true;\r\n        // }\r\n      }\r\n\r\n      for (let i = 0; i < buttonRect.length; i++) {\r\n        let texture;\r\n        if (worldState.keyActivated[i]) {\r\n          texture = buttonTex[i].press;\r\n        } else {\r\n          texture = buttonTex[i].unpress;\r\n        }\r\n        texture.draw(\r\n          batch,\r\n          buttonRect[i].x,\r\n          buttonRect[i].y,\r\n          buttonRect[i].width,\r\n          buttonRect[i].height,\r\n          buttonRect[i].width / 2,\r\n          buttonRect[i].height / 2,\r\n          0,\r\n          scaleButton,\r\n          scaleButton\r\n        );\r\n\r\n        // fillRect(\r\n        //   batch,\r\n        //   whiteTex,\r\n        //   buttonRect[i].x,\r\n        //   buttonRect[i].y,\r\n        //   buttonRect[i].width,\r\n        //   buttonRect[i].height\r\n        // );\r\n      }\r\n\r\n      finishTex.draw(\r\n        batch,\r\n        finishRect.x,\r\n        finishRect.y,\r\n        finishRect.width,\r\n        finishRect.height,\r\n        finishRect.width / 2,\r\n        finishRect.height / 2,\r\n        0,\r\n        scaleFinish,\r\n        scaleFinish\r\n      );\r\n\r\n      batch.end();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createRenderArrowButtonSystem;\r\n","import { Vector2 } from \"gdxjs\";\r\nconst activateKey = (key, keyActivated) => (keyActivated[key] = true);\r\nconst deactivateKey = (key, keyActivated) => (keyActivated[key] = false);\r\n\r\nconst getRectContainPoint = (x, y, buttonRect) => {\r\n  let index = -1;\r\n  for (let i = 0; i < 4; i++) {\r\n    const rect = buttonRect[i];\r\n    if (\r\n      x > rect.x &&\r\n      x < rect.x + rect.width &&\r\n      y > rect.y &&\r\n      y < rect.y + rect.height\r\n    ) {\r\n      return i;\r\n    }\r\n  }\r\n  return index;\r\n};\r\n\r\nconst getRectPassButtonPoint = (x, y, rect) => {\r\n  if (\r\n    x > rect.x &&\r\n    x < rect.x + rect.width &&\r\n    y > rect.y &&\r\n    y < rect.y + rect.height\r\n  ) {\r\n    return 1;\r\n  }\r\n  return 0;\r\n};\r\n\r\nconst checkHitRight = (type, notes, phaseIndex, worldState) => {\r\n  if (type === notes[phaseIndex][worldState.currentCheckingNoteIndex].type) {\r\n    notes[phaseIndex][worldState.currentCheckingNoteIndex].activated = true;\r\n    worldState.zoomOutNoteIndexs.push(worldState.currentCheckingNoteIndex);\r\n    worldState.currentCheckingNoteIndex += 1;\r\n    if (worldState.currentCheckingNoteIndex === notes[phaseIndex].length) {\r\n      worldState.currentCheckingNoteIndex = notes[phaseIndex].length - 1;\r\n      worldState.finishedPhase = true;\r\n    }\r\n  } else {\r\n    // MISS++;\r\n    worldState.currentCheckingNoteIndex = 0;\r\n    for (let i = 0; i < notes[phaseIndex].length; i++) {\r\n      notes[phaseIndex][i].activated = false;\r\n    }\r\n  }\r\n};\r\n\r\nconst createInputHandleGameScreenSystem = () => {\r\n  const rectTouches = {};\r\n  let coord = new Vector2();\r\n\r\n  return {\r\n    init(worldState, { canvas, camera, pixelRatio, inputHandler }) {\r\n      const { buttonRect, notes, finishRect } = worldState;\r\n\r\n      // const screenCoord = new Vector2();\r\n      // const worldCoord = new Vector2();\r\n      inputHandler.addEventListener(\"touchStart\", (x, y, id) => {\r\n        // x = x * pixelRatio;\r\n        // y = y * pixelRatio;\r\n        // screenCoord.set(x, y);\r\n        // camera.unprojectVector2(worldCoord, screenCoord);\r\n        coord.setVector(inputHandler.getTouchedWorldCoord());\r\n        // const rectIndex = getRectContainPoint(\r\n        //   worldCoord.x,\r\n        //   worldCoord.y,\r\n        //   buttonRect\r\n        // );\r\n        const rectIndex = getRectContainPoint(coord.x, coord.y, buttonRect);\r\n        if (rectIndex > -1 && !worldState.finishedPhase) {\r\n          rectTouches[id] = rectIndex;\r\n          activateKey(rectIndex, worldState.keyActivated);\r\n          checkHitRight(rectIndex, notes, worldState.phaseIndex, worldState);\r\n        } else if (worldState.finishedPhase) {\r\n          const rectButton = getRectPassButtonPoint(\r\n            coord.x,\r\n            coord.y,\r\n            finishRect\r\n          );\r\n          if (rectButton === 1) {\r\n            if (worldState.canPassPhase) {\r\n              // console.log(\"hit\");\r\n              worldState.hit++;\r\n              // HIT++;\r\n            } else {\r\n              // console.log(\"miss\");\r\n              worldState.miss++;\r\n              worldState.anim[worldState.animIndex] = worldState.missAnim;\r\n              // MISS++;\r\n            }\r\n            // worldState.newPhase = true;\r\n            worldState.hitFinishButton = true;\r\n          }\r\n        }\r\n      });\r\n\r\n      inputHandler.addEventListener(\"touchEnd\", (id) => {\r\n        deactivateKey(rectTouches[id], worldState.keyActivated);\r\n      });\r\n\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        if (e.which === 65) {\r\n          if (!worldState.finishedPhase) {\r\n            activateKey(0, worldState.keyActivated);\r\n            checkHitRight(0, notes, worldState.phaseIndex, worldState);\r\n          }\r\n        } else if (e.which === 87) {\r\n          if (!worldState.finishedPhase) {\r\n            activateKey(1, worldState.keyActivated);\r\n            checkHitRight(1, notes, worldState.phaseIndex, worldState);\r\n          }\r\n        } else if (e.which === 68) {\r\n          if (!worldState.finishedPhase) {\r\n            activateKey(2, worldState.keyActivated);\r\n            checkHitRight(2, notes, worldState.phaseIndex, worldState);\r\n          }\r\n        } else if (e.which === 83) {\r\n          if (!worldState.finishedPhase) {\r\n            activateKey(3, worldState.keyActivated);\r\n            checkHitRight(3, notes, worldState.phaseIndex, worldState);\r\n          }\r\n        }\r\n\r\n        if (worldState.finishedPhase && e.which === 32) {\r\n          if (worldState.canPassPhase) {\r\n            // console.log(\"hit\");\r\n            worldState.hit++;\r\n            // HIT++;\r\n          } else {\r\n            // console.log(\"miss\");\r\n            worldState.miss++;\r\n            worldState.anim[worldState.animIndex] = worldState.missAnim;\r\n            // MISS++;\r\n          }\r\n          worldState.hitFinishButton = true;\r\n        }\r\n      });\r\n\r\n      document.addEventListener(\"keyup\", (e) => {\r\n        if (e.which === 65) {\r\n          deactivateKey(0, worldState.keyActivated);\r\n        } else if (e.which === 87) {\r\n          deactivateKey(1, worldState.keyActivated);\r\n        } else if (e.which === 68) {\r\n          deactivateKey(2, worldState.keyActivated);\r\n        } else if (e.which === 83) {\r\n          deactivateKey(3, worldState.keyActivated);\r\n        }\r\n      });\r\n    },\r\n    update() {},\r\n  };\r\n};\r\n\r\nexport default createInputHandleGameScreenSystem;\r\n","const createButtonRenderSystem = () => {\r\n  let buttonTex = [];\r\n\r\n  return {\r\n    init(worldState, { assets }) {\r\n      const atlas = assets.auditionAtlas;\r\n\r\n      const downBtn = atlas.findRegion(\"down-btn\", -1);\r\n      const upBtn = atlas.findRegion(\"up-btn\", -1);\r\n      const leftBtn = atlas.findRegion(\"left-btn\", -1);\r\n      const rightBtn = atlas.findRegion(\"right-btn\", -1);\r\n\r\n      const downBtnGray = atlas.findRegion(\"down-btn-gray\", -1);\r\n      const upBtnGray = atlas.findRegion(\"up-btn-gray\", -1);\r\n      const leftBtnGray = atlas.findRegion(\"left-btn-gray\", -1);\r\n      const rightBtnGray = atlas.findRegion(\"right-btn-gray\", -1);\r\n\r\n      buttonTex = [\r\n        { active: leftBtn, passive: leftBtnGray },\r\n        { active: upBtn, passive: upBtnGray },\r\n        { active: rightBtn, passive: rightBtnGray },\r\n        { active: downBtn, passive: downBtnGray },\r\n      ];\r\n    },\r\n    update(\r\n      delta,\r\n      {\r\n        notes,\r\n        noteInfos,\r\n        currentCheckingNoteIndex,\r\n        phaseIndex,\r\n        zoomOutNoteIndexs,\r\n        zoomOutNoteInfos,\r\n        newPhase,\r\n      },\r\n\r\n      { batch, width, height, camera }\r\n    ) {\r\n      let currentNotesPhase = noteInfos[phaseIndex];\r\n      let currentNotesInfos = notes[phaseIndex];\r\n      let texture;\r\n\r\n      for (let i = 0; i < zoomOutNoteIndexs.length; i++) {\r\n        let index = zoomOutNoteIndexs[i];\r\n        zoomOutNoteInfos.push({\r\n          tex: buttonTex[currentNotesInfos[index].type].passive,\r\n          scale: 2,\r\n          postion: currentNotesPhase[index],\r\n        });\r\n        zoomOutNoteIndexs.splice(i, 1);\r\n      }\r\n\r\n      batch.setProjection(camera.combined);\r\n      batch.begin();\r\n      batch.setColor(1, 1, 1, 1);\r\n      if (!newPhase) {\r\n        for (let i = 0; i < currentNotesPhase.length; i++) {\r\n          let note = currentNotesPhase[i];\r\n          texture =\r\n            currentNotesInfos[i].activated === true\r\n              ? buttonTex[currentNotesInfos[i].type].active\r\n              : buttonTex[currentNotesInfos[i].type].passive;\r\n          texture.draw(batch, note.x, note.y, note.width, note.height);\r\n\r\n          if (zoomOutNoteInfos[i]) {\r\n            zoomOutNoteInfos[i].scale -= delta * 4;\r\n            let { tex, postion } = zoomOutNoteInfos[i];\r\n            batch.setColor(1, 1, 1, 0.5);\r\n            tex.draw(\r\n              batch,\r\n              postion.x,\r\n              postion.y,\r\n              postion.width,\r\n              postion.height,\r\n              postion.width / 2,\r\n              postion.height / 2,\r\n              0,\r\n              zoomOutNoteInfos[i].scale,\r\n              zoomOutNoteInfos[i].scale\r\n            );\r\n            batch.setColor(1, 1, 1, 1);\r\n            if (zoomOutNoteInfos[i].scale <= 1.1) {\r\n              zoomOutNoteInfos.splice(i, 1);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      batch.end();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createButtonRenderSystem;\r\n","const checkScoreType = (\r\n  realTimeDurationSet,\r\n  stateTime,\r\n  durationEachPhase,\r\n  durationZone,\r\n  scoreType,\r\n  textList,\r\n  textListInfos\r\n) => {\r\n  let texture;\r\n  let centerTime =\r\n    durationEachPhase - (2.3 / 4) * durationEachPhase - durationZone / 2;\r\n  let minTime = durationZone / 6;\r\n  if (\r\n    realTimeDurationSet - stateTime < centerTime + minTime &&\r\n    realTimeDurationSet - stateTime > centerTime - minTime\r\n  ) {\r\n    // console.log(\"perfect\");\r\n    scoreType = \"perfect\";\r\n    texture = { tex: textList[0], infos: textListInfos[0] };\r\n  } else if (\r\n    (realTimeDurationSet - stateTime < centerTime - minTime &&\r\n      realTimeDurationSet - stateTime > centerTime - minTime * 2) ||\r\n    (realTimeDurationSet - stateTime < centerTime + minTime * 2 &&\r\n      realTimeDurationSet - stateTime > centerTime + minTime)\r\n  ) {\r\n    // console.log(\"great\");\r\n    scoreType = \"great\";\r\n    texture = { tex: textList[1], infos: textListInfos[1] };\r\n  } else if (\r\n    (realTimeDurationSet - stateTime < centerTime - minTime * 2 &&\r\n      realTimeDurationSet - stateTime > centerTime - minTime * 3) ||\r\n    (realTimeDurationSet - stateTime < centerTime + minTime * 3 &&\r\n      realTimeDurationSet - stateTime > centerTime + minTime * 2)\r\n  ) {\r\n    // console.log(\"cool\");\r\n    scoreType = \"cool\";\r\n    texture = { tex: textList[2], infos: textListInfos[2] };\r\n  } else {\r\n    scoreType = \"miss\";\r\n    texture = { tex: textList[3], infos: textListInfos[3] };\r\n  }\r\n\r\n  return texture;\r\n};\r\n\r\nconst createDurationRenderSystem = () => {\r\n  let finishBarInfos = {};\r\n  let finishMetterInfos = {};\r\n  let finishMarkInfos = {};\r\n  let finishBar, finishMark, finishMetter, markEffect;\r\n  let durationZone;\r\n  let BAR_WIDTH, METTER_WIDTH, MARK_WIDTH, ME_WIDTH, ME_HEIGHT;\r\n  let scoreType;\r\n  let cool, great, perfect, miss, textList;\r\n  let coolInfos, greatInfos, perfectInfos, missInfos, textListInfos;\r\n  return {\r\n    init({ boundaryY }, { assets, width, height }) {\r\n      const atlas = assets.auditionAtlas;\r\n      const finishAtlas = assets.finishAtlas;\r\n\r\n      finishBar = atlas.findRegion(\"finish_bar\", -1);\r\n      finishMetter = atlas.findRegion(\"finish_metter\", -1);\r\n      finishMark = atlas.findRegion(\"finish_mark\", -1);\r\n      markEffect = finishAtlas.findRegion(\"finsh_mark_effect\", -1);\r\n\r\n      cool = finishAtlas.findRegion(\"cool\", -1);\r\n      great = finishAtlas.findRegion(\"great\", -1);\r\n      perfect = finishAtlas.findRegion(\"perfect\", -1);\r\n      miss = finishAtlas.findRegion(\"miss\", -1);\r\n\r\n      textList = [perfect, great, cool, miss];\r\n      const COOL_H = height / 25;\r\n      const COOL_W = (COOL_H * cool.width) / cool.height;\r\n      const GREAT_H = height / 25;\r\n      const GREAT_W = (GREAT_H * great.width) / great.height;\r\n      const PERFECT_H = height / 25;\r\n      const PERFECT_W = (PERFECT_H * perfect.width) / perfect.height;\r\n      const MISS_H = height / 25;\r\n      const MISS_W = (MISS_H * miss.width) / miss.height;\r\n\r\n      coolInfos = { width: COOL_W, height: COOL_H };\r\n      greatInfos = { width: GREAT_W, height: GREAT_H };\r\n      perfectInfos = { width: PERFECT_W, height: PERFECT_H };\r\n      missInfos = { width: MISS_W, height: MISS_H };\r\n      textListInfos = [perfectInfos, greatInfos, coolInfos, missInfos];\r\n\r\n      BAR_WIDTH = (width * 8.8) / 9;\r\n      const BAR_HEIGHT = (BAR_WIDTH * finishBar.height) / finishBar.width;\r\n      const BAR_START_X = (width - BAR_WIDTH) / 2;\r\n\r\n      MARK_WIDTH = BAR_WIDTH / 30;\r\n      const MARK_HEIGHT = (MARK_WIDTH * finishMark.height) / finishMark.width;\r\n\r\n      markEffect = finishAtlas.findRegion(\"finsh_mark_effect\", -1);\r\n      ME_WIDTH = MARK_WIDTH;\r\n      ME_HEIGHT = (ME_WIDTH * markEffect.height) / markEffect.width;\r\n\r\n      METTER_WIDTH = (BAR_WIDTH - MARK_WIDTH) / 4;\r\n      const METTER_HEIGHT =\r\n        (METTER_WIDTH * finishMetter.height) / finishMetter.width;\r\n\r\n      finishBarInfos = {\r\n        x: BAR_START_X,\r\n        y: boundaryY,\r\n        width: BAR_WIDTH,\r\n        height: BAR_HEIGHT,\r\n      };\r\n\r\n      finishMetterInfos = {\r\n        x: BAR_START_X + (2.3 / 4) * (BAR_WIDTH - MARK_WIDTH),\r\n        y: boundaryY + BAR_HEIGHT / 2 - METTER_HEIGHT,\r\n        width: METTER_WIDTH,\r\n        height: METTER_HEIGHT,\r\n      };\r\n\r\n      finishMarkInfos = {\r\n        y: boundaryY + BAR_HEIGHT / 2 - MARK_HEIGHT / 2,\r\n        width: MARK_WIDTH,\r\n        height: MARK_HEIGHT,\r\n      };\r\n    },\r\n    update(delta, worldState, { width, height, batch, camera }) {\r\n      let { stateTime, realTimeDurationSet, durationEachPhase } = worldState;\r\n      finishMarkInfos.x =\r\n        (width - BAR_WIDTH) / 2 +\r\n        (BAR_WIDTH * 29) / 30 -\r\n        ((realTimeDurationSet - stateTime) / durationEachPhase) *\r\n          ((BAR_WIDTH * 29) / 30);\r\n\r\n      durationZone =\r\n        (METTER_WIDTH * durationEachPhase) / (BAR_WIDTH - MARK_WIDTH) -\r\n        (MARK_WIDTH * durationEachPhase) / (BAR_WIDTH - MARK_WIDTH);\r\n\r\n      if (\r\n        realTimeDurationSet - stateTime <\r\n          durationEachPhase - (2.3 / 4) * durationEachPhase &&\r\n        realTimeDurationSet - stateTime >\r\n          durationEachPhase - (2.3 / 4) * durationEachPhase - durationZone &&\r\n        worldState.finishedPhase\r\n      ) {\r\n        worldState.canPassPhase = true;\r\n      } else {\r\n        worldState.canPassPhase = false;\r\n      }\r\n\r\n      //render\r\n      batch.setProjection(camera.combined);\r\n      batch.begin();\r\n      finishBar.draw(\r\n        batch,\r\n        finishBarInfos.x,\r\n        finishBarInfos.y,\r\n        finishBarInfos.width,\r\n        finishBarInfos.height\r\n      );\r\n\r\n      finishMetter.draw(\r\n        batch,\r\n        finishMetterInfos.x,\r\n        finishMetterInfos.y,\r\n        finishMetterInfos.width,\r\n        finishMetterInfos.height\r\n      );\r\n\r\n      if (worldState.hitFinishButton) {\r\n        // draw text\r\n        let texture = checkScoreType(\r\n          realTimeDurationSet,\r\n          stateTime,\r\n          durationEachPhase,\r\n          durationZone,\r\n          scoreType,\r\n          textList,\r\n          textListInfos\r\n        );\r\n        worldState.textPopUp.startY = Math.max(\r\n          (height * 1.1) / 3,\r\n          (worldState.textPopUp.startY -= (delta * height) / 3)\r\n        );\r\n\r\n        // console.log(worldState.textPopUp.scale);\r\n        worldState.textPopUp.scale = Math.min(\r\n          1,\r\n          (worldState.textPopUp.scale += delta * 5)\r\n        );\r\n\r\n        if (worldState.textPopUp.startY === (height * 1.1) / 3) {\r\n          worldState.textPopUp.opacity = Math.max(\r\n            0,\r\n            (worldState.textPopUp.opacity -= delta * 5)\r\n          );\r\n        }\r\n\r\n        batch.setColor(1, 1, 1, worldState.textPopUp.opacity);\r\n        texture.tex.draw(\r\n          batch,\r\n          width / 2 - texture.infos.width / 2,\r\n          worldState.textPopUp.startY,\r\n          texture.infos.width,\r\n          texture.infos.height,\r\n          texture.infos.width / 2,\r\n          texture.infos.height / 2,\r\n          0,\r\n          worldState.textPopUp.scale,\r\n          worldState.textPopUp.scale\r\n        );\r\n      }\r\n\r\n      if (!worldState.hitFinishButton) {\r\n        worldState.finishMarkEffect = { scale: 1, opacity: 1 };\r\n        finishMark.draw(\r\n          batch,\r\n          finishMarkInfos.x + finishMarkInfos.width / 2,\r\n          finishMarkInfos.y,\r\n          finishMarkInfos.width,\r\n          finishMarkInfos.height\r\n        );\r\n      } else {\r\n        // mark effect\r\n        worldState.finishMarkEffect.scale = Math.min(\r\n          2.3,\r\n          (worldState.finishMarkEffect.scale += delta * 10)\r\n        );\r\n        if (worldState.finishMarkEffect.scale === 2.3) {\r\n          worldState.finishMarkEffect.opacity = Math.max(\r\n            0,\r\n            (worldState.finishMarkEffect.opacity -= delta * 5)\r\n          );\r\n        }\r\n        batch.setColor(1, 1, 1, worldState.finishMarkEffect.opacity);\r\n        markEffect.draw(\r\n          batch,\r\n          finishMarkInfos.x +\r\n            finishMarkInfos.width / 2 -\r\n            ME_WIDTH / 2 +\r\n            finishMarkInfos.width / 2,\r\n          finishMarkInfos.y + finishMarkInfos.height / 2 - ME_HEIGHT / 2,\r\n          ME_WIDTH,\r\n          ME_HEIGHT,\r\n          ME_WIDTH / 2,\r\n          ME_HEIGHT / 2,\r\n          0,\r\n          worldState.finishMarkEffect.scale,\r\n          worldState.finishMarkEffect.scale\r\n        );\r\n        batch.setColor(1, 1, 1, 1);\r\n        if (worldState.finishMarkEffect.opacity === 0) {\r\n          worldState.newPhase = true;\r\n        }\r\n      }\r\n      batch.end();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createDurationRenderSystem;\r\n","import createOrthoCamera2 from \"../components/orthoCamera2\";\r\nimport { resizeCanvas } from \"gdxjs\";\r\n\r\nconst createHandAnimationRenderSystem = () => {\r\n  let camera;\r\n  const animOffset = {\r\n    buom_bay_right: {\r\n      x: 5,\r\n      y: -3,\r\n    },\r\n    xoa_tay: {\r\n      x: -5,\r\n      y: -5,\r\n    },\r\n    buom_bay_left: {\r\n      x: 3,\r\n      y: -3,\r\n    },\r\n    choang_nhau: {\r\n      x: 5,\r\n      y: 0,\r\n    },\r\n    tinh_ban: {\r\n      x: 5,\r\n      y: 2,\r\n    },\r\n    ca_sau: {\r\n      x: 4,\r\n      y: 3,\r\n    },\r\n  };\r\n  let offsetX, offsetY, DRAW_WIDTH, DRAW_HEIGHT;\r\n  return {\r\n    init(worldState, { width, height, canvas, pixelRatio, spriter }) {\r\n      const [cWidth, cHeight] = resizeCanvas(canvas, pixelRatio);\r\n      camera = createOrthoCamera2(width, height, cWidth, cHeight);\r\n      DRAW_WIDTH = width;\r\n      DRAW_HEIGHT = DRAW_HEIGHT = width / spriter.getAspect();\r\n      spriter.setEntity(\"hands\");\r\n      // spriter.setAnim(worldState.anim[worldState.animIndex]);\r\n    },\r\n    update(delta, worldState, { spriter, batch, width, height, pixelRatio }) {\r\n      batch.setProjection(camera.combined);\r\n      batch.begin();\r\n      spriter.setAnim(worldState.anim[worldState.animIndex]);\r\n      spriter.update(delta * 1000);\r\n      offsetX = 0;\r\n      offsetY = 0;\r\n      const offset = animOffset[spriter.getAnim()];\r\n      if (offset) {\r\n        offsetX = offset.x;\r\n        offsetY = offset.y;\r\n      }\r\n      spriter.draw(\r\n        batch,\r\n        0 + offsetX,\r\n        height / 2 - DRAW_HEIGHT / 2 + offsetY,\r\n        DRAW_WIDTH,\r\n        DRAW_HEIGHT,\r\n        width / height\r\n      );\r\n      batch.end();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createHandAnimationRenderSystem;\r\n","import { mat4 } from \"gl-matrix\";\r\nimport { unproject } from \"gdxjs/lib/mathUtils\";\r\nexport default (width, height, viewportWidth, viewportHeight) => {\r\n  const combined = mat4.create();\r\n  const transform = mat4.create();\r\n  const invOrtho = mat4.create();\r\n  const lookAtMatrix = mat4.create();\r\n  const position = [0, 0];\r\n  const NEAR = 0;\r\n  const FAR = 1;\r\n  const tmp3 = [0, 0, 0];\r\n  const eye = [0, 0, FAR];\r\n  const center = [0, 0, NEAR];\r\n  const up = [0, 1, 0];\r\n\r\n  const update = () => {\r\n    mat4.ortho(\r\n      combined,\r\n      -width / 2,\r\n      width / 2,\r\n      -height / 2,\r\n      height / 2,\r\n      NEAR,\r\n      FAR\r\n    );\r\n    const x = position[0];\r\n    const y = position[1];\r\n    eye[0] = center[0] = x;\r\n    eye[1] = center[1] = y;\r\n    mat4.identity(transform);\r\n    mat4.lookAt(lookAtMatrix, eye, center, up);\r\n    mat4.mul(transform, transform, lookAtMatrix);\r\n    mat4.mul(combined, combined, transform);\r\n    mat4.invert(invOrtho, combined);\r\n  };\r\n\r\n  update();\r\n  return {\r\n    combined,\r\n\r\n    setMatrix(mat) {\r\n      mat4.copy(combined, mat);\r\n      mat4.invert(invOrtho, combined);\r\n    },\r\n\r\n    setYUp(yUp) {\r\n      if (yUp) {\r\n        up[1] = -1;\r\n      } else {\r\n        up[1] = 1;\r\n      }\r\n\r\n      update();\r\n    },\r\n\r\n    setPosition(x, y) {\r\n      position[0] = x;\r\n      position[1] = y;\r\n      update();\r\n    },\r\n\r\n    unprojectVector2(out, input) {\r\n      tmp3[0] = input.x;\r\n      tmp3[1] = input.y;\r\n      tmp3[2] = 0;\r\n      unproject(tmp3, tmp3, invOrtho, 0, 0, viewportWidth, viewportHeight);\r\n      out.set(tmp3[0], tmp3[1]);\r\n    },\r\n\r\n    resize(newWidth, newHeight) {\r\n      width = newWidth;\r\n      height = newHeight;\r\n      update();\r\n    },\r\n  };\r\n};\r\n","import { fillRect } from \"gdxjs\";\r\n\r\nconst createCurtainRenderSystem = () => {\r\n  let curtainInfors = {};\r\n  return {\r\n    init(worldState, { assets, width }) {\r\n      const curtain = assets.curtain;\r\n      const CURTAIN_WIDTH = width;\r\n      const CURTAIN_HEIGHT = (CURTAIN_WIDTH * curtain.height) / curtain.width;\r\n      curtainInfors = { tex: curtain, w: CURTAIN_WIDTH, h: CURTAIN_HEIGHT };\r\n    },\r\n    update(delta, worldState, { camera, batch }) {\r\n      batch.setProjection(camera.combined);\r\n      batch.begin();\r\n      batch.setColor(1, 1, 1, 1);\r\n      fillRect(\r\n        batch,\r\n        curtainInfors.tex,\r\n        0,\r\n        0,\r\n        curtainInfors.w,\r\n        curtainInfors.h\r\n      );\r\n      batch.end();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createCurtainRenderSystem;\r\n","export const checkPointInsideRect = (point, verts, DEVICE_PIXEL_RATIO = 1) => {\r\n  const x = point.x * DEVICE_PIXEL_RATIO;\r\n  const y = point.y * DEVICE_PIXEL_RATIO;\r\n  // const minX = Math.min(verts[0], verts[2], verts[4], verts[6]);\r\n  // const maxX = Math.max(verts[0], verts[2], verts[4], verts[6]);\r\n  // const minY = Math.min(verts[1], verts[3], verts[5], verts[7]);\r\n  // const maxY = Math.max(verts[1], verts[3], verts[5], verts[7]);\r\n\r\n  const minX = verts[0];\r\n  const maxX = verts[0] + verts[2];\r\n  const minY = verts[1];\r\n  const maxY = verts[1] + verts[3];\r\n  if (x < minX || x > maxX || y < minY || y > maxY) return false;\r\n  return true;\r\n};\r\n","import { createViewportAwareInputHandler, fillRect } from \"gdxjs\";\r\nimport createRenderStartScreenSystem from \"./StartScreen\";\r\nimport { checkPointInsideRect } from \"../utils/coordUtils\";\r\n\r\nconst caculateString = (infos, numberInfos, width, percentageInfos) => {\r\n  let sumLength = 0;\r\n  let numberList = [];\r\n  for (let i = 0; i < infos.length; i++) {\r\n    sumLength += numberInfos[i].width;\r\n  }\r\n  sumLength += percentageInfos.width;\r\n  const START_X = width / 2 - sumLength / 2;\r\n\r\n  let distanceTmp = 0;\r\n  for (let i = 0; i < infos.length; i++) {\r\n    let numberWidth = numberInfos[i - 1] ? numberInfos[i - 1].width : 0;\r\n    distanceTmp += numberWidth;\r\n    numberList.push({\r\n      tex: numberInfos[infos[i]].tex,\r\n      x: START_X + distanceTmp,\r\n      width: numberInfos[i].width,\r\n    });\r\n  }\r\n  distanceTmp += numberInfos[numberInfos.length - 1].width;\r\n  numberList.push({\r\n    tex: percentageInfos.tex,\r\n    x: START_X + distanceTmp,\r\n    width: percentageInfos.width,\r\n  });\r\n\r\n  return numberList;\r\n};\r\n\r\nconst getStringInfos = (result) => {\r\n  let infos = [];\r\n  for (let i = 0; i < result.length; i++) {\r\n    const char = result.charAt(i);\r\n    infos.push(parseInt(char));\r\n  }\r\n  return infos;\r\n};\r\n\r\nconst createRenderEndScreenSystem = (Game) => {\r\n  const goToStartScreen = async () => {\r\n    Game.setCurrentScreen(await createRenderStartScreenSystem(Game));\r\n  };\r\n  const { batch, canvas, width, height, camera, viewport, assets } = Game;\r\n  const inputHandler = createViewportAwareInputHandler(canvas, viewport);\r\n  const atlas = assets.auditionAtlas;\r\n  const startEndAtlas = assets.startEndAtlas;\r\n\r\n  const table = atlas.findRegion(\"table\", -1);\r\n  const TABLE_WIDTH = width;\r\n  const TABLE_HEIGHT = (TABLE_WIDTH * table.height) / table.width;\r\n\r\n  const bg = atlas.findRegion(\"bg\", -1);\r\n  const BG_WIDTH = width;\r\n  const BG_HEIGHT = (BG_WIDTH * bg.height) / bg.width;\r\n\r\n  const curtain = assets.curtain;\r\n  const CURTAIN_WIDTH = width;\r\n  const CURTAIN_HEIGHT = (CURTAIN_WIDTH * curtain.height) / curtain.width;\r\n\r\n  const restartButton = startEndAtlas.findRegion(\"restart_button\", -1);\r\n  const quote = startEndAtlas.findRegion(\"quote\", -1);\r\n  const yourScore = startEndAtlas.findRegion(\"your_score\", -1);\r\n  const percentage = startEndAtlas.findRegion(\"percentage\", -1);\r\n\r\n  const RB_WIDTH = width / 4.5;\r\n  const RB_HEIGHT = (RB_WIDTH * restartButton.height) / restartButton.width;\r\n  const RB_START_X = width / 2 - RB_WIDTH / 2;\r\n  const RB_START_Y = (height * 2.3) / 3;\r\n\r\n  const buttonRect = [RB_START_X, RB_START_Y, RB_WIDTH, RB_HEIGHT];\r\n\r\n  const Q_WIDHT = width * 0.95;\r\n  const Q_HEIGHT = (Q_WIDHT * quote.height) / quote.width;\r\n\r\n  const YS_WIDTH = width / 1.8;\r\n  const YS_HEIGH = (YS_WIDTH * yourScore.height) / yourScore.width;\r\n\r\n  const number0 = startEndAtlas.findRegion(\"0_end\", -1);\r\n  const number1 = startEndAtlas.findRegion(\"1_end\", -1);\r\n  const number2 = startEndAtlas.findRegion(\"2_end\", -1);\r\n  const number3 = startEndAtlas.findRegion(\"3_end\", -1);\r\n  const number4 = startEndAtlas.findRegion(\"4_end\", -1);\r\n  const number5 = startEndAtlas.findRegion(\"5_end\", -1);\r\n  const number6 = startEndAtlas.findRegion(\"6_end\", -1);\r\n  const number7 = startEndAtlas.findRegion(\"7_end\", -1);\r\n  const number8 = startEndAtlas.findRegion(\"8_end\", -1);\r\n  const number9 = startEndAtlas.findRegion(\"9_end\", -1);\r\n\r\n  const NB_HEIGHT = height / 8;\r\n  const NB0_WIDHT = (NB_HEIGHT * number0.width) / number0.height;\r\n  const NB1_WIDHT = (NB_HEIGHT * number1.width) / number1.height;\r\n  const NB2_WIDHT = (NB_HEIGHT * number2.width) / number2.height;\r\n  const NB3_WIDHT = (NB_HEIGHT * number3.width) / number3.height;\r\n  const NB4_WIDHT = (NB_HEIGHT * number4.width) / number4.height;\r\n  const NB5_WIDHT = (NB_HEIGHT * number5.width) / number5.height;\r\n  const NB6_WIDHT = (NB_HEIGHT * number6.width) / number6.height;\r\n  const NB7_WIDHT = (NB_HEIGHT * number7.width) / number7.height;\r\n  const NB8_WIDHT = (NB_HEIGHT * number8.width) / number8.height;\r\n  const NB9_WIDHT = (NB_HEIGHT * number9.width) / number9.height;\r\n\r\n  const numberInfos = [\r\n    { tex: number0, width: NB0_WIDHT },\r\n    { tex: number1, width: NB1_WIDHT },\r\n    { tex: number2, width: NB2_WIDHT },\r\n    { tex: number3, width: NB3_WIDHT },\r\n    { tex: number4, width: NB4_WIDHT },\r\n    { tex: number5, width: NB5_WIDHT },\r\n    { tex: number6, width: NB6_WIDHT },\r\n    { tex: number7, width: NB7_WIDHT },\r\n    { tex: number8, width: NB8_WIDHT },\r\n    { tex: number9, width: NB9_WIDHT },\r\n  ];\r\n\r\n  const PT_HEIGHT = NB_HEIGHT;\r\n  const PT_WIDTH = (PT_HEIGHT * percentage.width) / percentage.height;\r\n  const percentageInfos = { tex: percentage, width: PT_WIDTH };\r\n\r\n  const result = Game.completePercentage.toString();\r\n  const stringInfos = getStringInfos(result, numberInfos);\r\n  const numberList = caculateString(\r\n    stringInfos,\r\n    numberInfos,\r\n    width,\r\n    percentageInfos\r\n  );\r\n\r\n  inputHandler.addEventListener(\"touchStart\", (x, y) => {\r\n    const point = inputHandler.getTouchedWorldCoord();\r\n    if (checkPointInsideRect({ x: point.x, y: point.y }, buttonRect)) {\r\n      Game.completePercentage = 0;\r\n      goToStartScreen();\r\n    }\r\n  });\r\n\r\n  const update = (delta) => {\r\n    // console.log(numberList);\r\n    batch.setProjection(camera.combined);\r\n    batch.begin();\r\n    batch.setColor(1, 1, 1, 1);\r\n    bg.draw(\r\n      batch,\r\n      width / 2 - BG_WIDTH / 2,\r\n      -BG_HEIGHT / 30,\r\n      BG_WIDTH,\r\n      BG_HEIGHT\r\n    );\r\n\r\n    table.draw(\r\n      batch,\r\n      width / 2 - TABLE_WIDTH / 2,\r\n      height / 2 - height / 20,\r\n      TABLE_WIDTH,\r\n      TABLE_HEIGHT\r\n    );\r\n\r\n    fillRect(batch, curtain, 0, 0, CURTAIN_WIDTH, CURTAIN_HEIGHT);\r\n\r\n    restartButton.draw(batch, RB_START_X, RB_START_Y, RB_WIDTH, RB_HEIGHT);\r\n    quote.draw(batch, width / 2 - Q_WIDHT / 2, height / 2, Q_WIDHT, Q_HEIGHT);\r\n    yourScore.draw(\r\n      batch,\r\n      width / 2 - YS_WIDTH / 2,\r\n      height / 4,\r\n      YS_WIDTH,\r\n      YS_HEIGH\r\n    );\r\n\r\n    for (let i = 0; i < numberList.length; i++) {\r\n      numberList[i].tex.draw(\r\n        batch,\r\n        numberList[i].x,\r\n        height / 3,\r\n        numberList[i].width,\r\n        NB_HEIGHT\r\n      );\r\n    }\r\n\r\n    batch.end();\r\n  };\r\n  return {\r\n    update,\r\n    destroy() {\r\n      inputHandler.cleanup();\r\n    },\r\n  };\r\n};\r\n\r\nexport default createRenderEndScreenSystem;\r\n","import { createViewportAwareInputHandler } from \"gdxjs\";\r\nimport createWorld from \"../createWorld\";\r\nimport createBackGroundRenderSystem from \"../system/BgRenderSystem\";\r\nimport createRenderArrowButtonSystem from \"../system/ArrowButtonRenderSystem\";\r\nimport createInputHandleGameScreenSystem from \"../system/InputHandlerGameScreenSystem\";\r\nimport createButtonRenderSystem from \"../system/ButtonRenderSystem\";\r\nimport createDurationRenderSystem from \"../system/BarDurationRenderSystem\";\r\nimport createHandAnimationRenderSystem from \"../system/HandAnimationRenderSystem\";\r\nimport createCurtainRenderSystem from \"../system/CurtainRenderSystem\";\r\nimport data from \"../data\";\r\n\r\nimport createRenderEndScreenSystem from \"./EndScreen\";\r\n\r\nexport default (Game) => {\r\n  const {\r\n    canvas,\r\n    width,\r\n    height,\r\n    gl,\r\n    batch,\r\n    whiteTex,\r\n    camera,\r\n    pixelRatio,\r\n    assets,\r\n    spriter,\r\n    viewport,\r\n    sound,\r\n  } = Game;\r\n\r\n  // const inputHandler = new InputHandler(canvas);\r\n  const inputHandler = createViewportAwareInputHandler(canvas, viewport);\r\n\r\n  const datas = data;\r\n  const lines = datas.split(\"\\n\");\r\n  const infos = [];\r\n  for (let i = 0; i < lines.length; i++) {\r\n    const value = lines[i].split(\",\").map((s) => s.trim());\r\n    infos.push({\r\n      start: parseInt(value[0]),\r\n      duration: parseInt(value[1]),\r\n      restTime: parseInt(value[2]),\r\n      nodes: parseInt(value[3]),\r\n    });\r\n  }\r\n\r\n  sound.play();\r\n\r\n  const scripts = [];\r\n  for (let i = 0; i < infos.length; i++) {\r\n    scripts.push(infos[i].nodes);\r\n  }\r\n\r\n  const notes = []; // cha type, opacity mi nt / phase\r\n\r\n  for (let s of scripts) {\r\n    const tmpArray = [];\r\n    for (let i = 0; i < s; i++) {\r\n      tmpArray.push({\r\n        type: Math.floor(Math.random() * 4),\r\n        activated: false,\r\n      });\r\n    }\r\n    notes.push(tmpArray);\r\n  }\r\n\r\n  //  note information\r\n  const NOTE_SIZE = width / 7.5;\r\n  const NOTE_MARGIN = width / 15;\r\n  const NOTE_START_Y = height / 2 + height / 30;\r\n  const NOTE_RECTS = [];\r\n\r\n  for (let i = 0; i < notes.length; i++) {\r\n    const tmpArray = [];\r\n    let NOTE_Y = 0;\r\n    let NOTE_X = 0;\r\n    let length = 0;\r\n    for (let j = 0; j < notes[i].length; j++) {\r\n      let noteI = 0;\r\n      if (j <= 3) {\r\n        length = notes[i].length;\r\n        NOTE_X =\r\n          (width -\r\n            NOTE_MARGIN * (Math.min(4, length) - 1) -\r\n            NOTE_SIZE * Math.min(4, length)) /\r\n          2;\r\n        NOTE_Y = NOTE_START_Y;\r\n        noteI = j;\r\n      } else {\r\n        length = notes[i].length - 4;\r\n        NOTE_X = (width - NOTE_MARGIN * (length - 1) - NOTE_SIZE * length) / 2;\r\n        NOTE_Y = NOTE_START_Y + height / 13;\r\n        noteI = Math.abs(4 - j);\r\n      }\r\n\r\n      tmpArray.push({\r\n        x: NOTE_X + (NOTE_SIZE + NOTE_MARGIN) * noteI,\r\n        y: NOTE_Y,\r\n        width: NOTE_SIZE,\r\n        height: NOTE_SIZE,\r\n      });\r\n    }\r\n    NOTE_RECTS.push(tmpArray);\r\n  }\r\n\r\n  const anim = [\r\n    \"buom_bay_right\",\r\n    \"xoa_tay\",\r\n    \"buom_bay_left\",\r\n    \"choang_nhau\",\r\n    \"tinh_ban\",\r\n    \"ca_sau\",\r\n    \"buom_bay_right\",\r\n    \"xoa_tay\",\r\n    \"buom_bay_left\",\r\n    \"choang_nhau\",\r\n  ];\r\n\r\n  const missAnim = \"bam_sai\";\r\n\r\n  const worldState = {\r\n    hit: 0,\r\n    miss: 0,\r\n    anim: anim,\r\n    missAnim: missAnim,\r\n    animIndex: -1,\r\n    stateTime: 0,\r\n    keyActivated: [],\r\n    boundaryY: height / 2 - height / 20,\r\n    gameOver: false,\r\n    buttonInfos: null,\r\n    durationBarInfos: {\r\n      duration: 4,\r\n      x: (width - (width * 4) / 5) / 2,\r\n      y: (height * 3) / 4,\r\n      width: (width * 4) / 5,\r\n      height: height / 10,\r\n    },\r\n    notes: notes,\r\n    noteInfos: NOTE_RECTS,\r\n    currentCheckingNoteIndex: 0,\r\n    phaseIndex: -1,\r\n    durationEachPhase: 4,\r\n    realTimeDurationSet: 4,\r\n    newPhase: true,\r\n    canPassPhase: false,\r\n    finishedPhase: false,\r\n    zoomOutNoteIndexs: [],\r\n    zoomOutNoteInfos: [],\r\n    hitFinishButton: false,\r\n    starEffect: { scale1: 1, opacity1: 1, scale2: 1, opacity2: 1 },\r\n    finishMarkEffect: { scale: 1, opacity: 1 },\r\n    textPopUp: { opacity: 1, scale: 0.5, startY: (height * 1.3) / 3 },\r\n  };\r\n\r\n  const extra = {\r\n    canvas,\r\n    width,\r\n    height,\r\n    gl,\r\n    batch,\r\n    whiteTex,\r\n    camera,\r\n    pixelRatio,\r\n    assets,\r\n    spriter,\r\n    inputHandler,\r\n  };\r\n\r\n  // let MISS = 0;\r\n  // let HIT = 0;\r\n\r\n  const world = createWorld(worldState, extra);\r\n  world.addSystem(createBackGroundRenderSystem());\r\n  world.addSystem(createHandAnimationRenderSystem());\r\n  world.addSystem(createCurtainRenderSystem());\r\n  world.addSystem(createRenderArrowButtonSystem());\r\n  world.addSystem(createInputHandleGameScreenSystem());\r\n  world.addSystem(createDurationRenderSystem());\r\n  world.addSystem(createButtonRenderSystem());\r\n\r\n  const goToEndScreen = async () => {\r\n    Game.setCurrentScreen(await createRenderEndScreenSystem(Game));\r\n  };\r\n\r\n  let timeAccumulate = 0;\r\n  let counter = 0;\r\n  let firstRun = true;\r\n\r\n  const update = (delta) => {\r\n    timeAccumulate += delta;\r\n    if (!worldState.hitFinishButton) {\r\n      worldState.stateTime += delta;\r\n    }\r\n    if (firstRun) {\r\n      timeAccumulate = infos[counter].duration + infos[counter].restTime + 1;\r\n    }\r\n\r\n    if (timeAccumulate > infos[counter].duration) {\r\n      if (!worldState.newPhase) {\r\n        worldState.anim[worldState.animIndex] = worldState.missAnim;\r\n      }\r\n      worldState.newPhase = true;\r\n    }\r\n    if (\r\n      // worldState.stateTime > worldState.realTimeDurationSet ||\r\n      // worldState.newPhase\r\n      timeAccumulate >\r\n      infos[counter].duration + infos[counter].restTime\r\n    ) {\r\n      if (firstRun) {\r\n        firstRun = false;\r\n        counter = -1;\r\n      }\r\n      timeAccumulate = 0;\r\n      counter += 1;\r\n      // if (worldState.stateTime > worldState.realTimeDurationSet) {\r\n      //   worldState.miss += 1;\r\n      //   // MISS++;\r\n      // }\r\n      worldState.animIndex += 1;\r\n      if (worldState.animIndex === anim.length) {\r\n        Game.completePercentage = Math.floor(\r\n          (worldState.hit / anim.length) * 100\r\n        );\r\n        goToEndScreen();\r\n      }\r\n      worldState.starEffect = {\r\n        scale1: 1,\r\n        scale2: 1,\r\n        opacity1: 1,\r\n        opacity2: 1,\r\n      };\r\n      worldState.textPopUp = {\r\n        opacity: 1,\r\n        scale: 0.5,\r\n        startY: (height * 1.3) / 3,\r\n      };\r\n      worldState.hitFinishButton = false;\r\n      worldState.newPhase = false;\r\n      worldState.finishedPhase = false;\r\n      worldState.canPassPhase = false;\r\n      worldState.zoomOutNoteIndexs.length = 0;\r\n      worldState.zoomOutNoteInfos.length = 0;\r\n      if (worldState.animIndex < anim.length) {\r\n        worldState.durationEachPhase = infos[worldState.animIndex].duration;\r\n      }\r\n      worldState.realTimeDurationSet =\r\n        worldState.stateTime + worldState.durationEachPhase;\r\n      worldState.currentCheckingNoteIndex = 0;\r\n      worldState.phaseIndex += 1;\r\n      worldState.phaseIndex =\r\n        worldState.phaseIndex > scripts.length - 1\r\n          ? scripts.length - 1\r\n          : worldState.phaseIndex;\r\n    }\r\n    batch.setProjection(camera.combined);\r\n    world.update(delta);\r\n  };\r\n\r\n  return {\r\n    update,\r\n    destroy() {\r\n      inputHandler.cleanup();\r\n    },\r\n  };\r\n};\r\n","// start, duration, relax, node\r\nexport default `0,4,4,3\r\n  8,5,7,4\r\n  20,4,0,4\r\n  24,6,0,6\r\n  30,4,0,6\r\n  34,5,0,5\r\n  39,4,0,5\r\n  43,4,2,6\r\n  49,5,0,5\r\n  54,5,0,6`;\r\n","export default (worldState, extra) => {\r\n  const systems = [];\r\n  const passiveSystems = [];\r\n  return {\r\n    addSystem(system, passive = false) {\r\n      system.init && system.init(worldState, extra);\r\n      if (passive) {\r\n        passiveSystems.push(system);\r\n      } else {\r\n        systems.push(system);\r\n      }\r\n    },\r\n    update(delta, runPassive = true) {\r\n      for (let system of systems) {\r\n        system.update(delta, worldState, extra);\r\n      }\r\n      if (runPassive) {\r\n        for (let system of passiveSystems) {\r\n          system.update(delta, worldState, extra);\r\n        }\r\n      }\r\n    }\r\n  };\r\n};\r\n","import { fillRect, createViewportAwareInputHandler } from \"gdxjs\";\r\nimport createRenderGameScreenSystem from \"./GameScreen\";\r\nimport { checkPointInsideRect } from \"../utils/coordUtils\";\r\n\r\nexport default (Game) => {\r\n  const {\r\n    batch,\r\n    canvas,\r\n    width,\r\n    height,\r\n    whiteTex,\r\n    camera,\r\n    viewport,\r\n    assets,\r\n  } = Game;\r\n\r\n  // const inputHandler = new InputHandler(canvas);\r\n  const inputHandler = createViewportAwareInputHandler(canvas, viewport);\r\n  const atlas = assets.auditionAtlas;\r\n  const startEndAtlas = assets.startEndAtlas;\r\n\r\n  const table = atlas.findRegion(\"table\", -1);\r\n  const TABLE_WIDTH = width;\r\n  const TABLE_HEIGHT = (TABLE_WIDTH * table.height) / table.width;\r\n\r\n  const bg = atlas.findRegion(\"bg\", -1);\r\n  const BG_WIDTH = width;\r\n  const BG_HEIGHT = (BG_WIDTH * bg.height) / bg.width;\r\n\r\n  const curtain = assets.curtain;\r\n  const CURTAIN_WIDTH = width;\r\n  const CURTAIN_HEIGHT = (CURTAIN_WIDTH * curtain.height) / curtain.width;\r\n\r\n  const number1 = startEndAtlas.findRegion(\"number1_start\", -1);\r\n  const number2 = startEndAtlas.findRegion(\"number2_Start\", -1);\r\n  const number3 = startEndAtlas.findRegion(\"number3_start\", -1);\r\n  const startButton = startEndAtlas.findRegion(\"start_button\");\r\n\r\n  const BUTTON_WIDTH = width / 2;\r\n  const BUTTON_HEIGHT = (BUTTON_WIDTH * startButton.height) / startButton.width;\r\n  const BUTTON_START_X = width / 2 - BUTTON_WIDTH / 2;\r\n  const BUTTON_START_Y = (height * 2.3) / 3;\r\n\r\n  const buttonRect = [\r\n    BUTTON_START_X,\r\n    BUTTON_START_Y,\r\n    BUTTON_WIDTH,\r\n    BUTTON_HEIGHT,\r\n  ];\r\n\r\n  const NB1_HEIGHT = height / 8;\r\n  const NB1_WIDHT = (NB1_HEIGHT * number1.width) / number1.height;\r\n\r\n  const NB2_HEIGHT = height / 8;\r\n  const NB2_WIDHT = (NB2_HEIGHT * number2.width) / number2.height;\r\n\r\n  const NB3_HEIGHT = height / 8;\r\n  const NB3_WIDHT = (NB1_HEIGHT * number3.width) / number3.height;\r\n\r\n  let startCountDown = false;\r\n  let stateTime = 0;\r\n\r\n  const goToGameScreen = async () => {\r\n    Game.setCurrentScreen(await createRenderGameScreenSystem(Game));\r\n  };\r\n\r\n  inputHandler.addEventListener(\"touchStart\", (x, y) => {\r\n    let point = inputHandler.getTouchedWorldCoord();\r\n    if (checkPointInsideRect({ x: point.x, y: point.y }, buttonRect)) {\r\n      startCountDown = true;\r\n    }\r\n    // goToGameScreen();\r\n  });\r\n\r\n  const update = (delta) => {\r\n    camera.setPosition(0, 0);\r\n    batch.setProjection(camera.combined);\r\n    batch.begin();\r\n    batch.setColor(1, 1, 1, 1);\r\n    bg.draw(\r\n      batch,\r\n      width / 2 - BG_WIDTH / 2,\r\n      -BG_HEIGHT / 30,\r\n      BG_WIDTH,\r\n      BG_HEIGHT\r\n    );\r\n\r\n    table.draw(\r\n      batch,\r\n      width / 2 - TABLE_WIDTH / 2,\r\n      height / 2 - height / 20,\r\n      TABLE_WIDTH,\r\n      TABLE_HEIGHT\r\n    );\r\n\r\n    fillRect(batch, curtain, 0, 0, CURTAIN_WIDTH, CURTAIN_HEIGHT);\r\n\r\n    startButton.draw(\r\n      batch,\r\n      buttonRect[0],\r\n      buttonRect[1],\r\n      buttonRect[2],\r\n      buttonRect[3]\r\n    );\r\n\r\n    if (startCountDown && stateTime < 3) {\r\n      let tex;\r\n      let infos;\r\n      if (stateTime < 1) {\r\n        tex = number3;\r\n        infos = [NB3_WIDHT, NB3_HEIGHT];\r\n      } else if (stateTime > 1 && stateTime < 2) {\r\n        tex = number2;\r\n        infos = [NB2_WIDHT, NB2_HEIGHT];\r\n      } else if (stateTime > 2 && stateTime < 3) {\r\n        tex = number1;\r\n        infos = [NB1_WIDHT, NB1_HEIGHT];\r\n      }\r\n      stateTime += delta;\r\n      tex.draw(\r\n        batch,\r\n        width / 2 - infos[0] / 2,\r\n        (height * 1) / 5,\r\n        infos[0],\r\n        infos[1]\r\n      );\r\n    }\r\n\r\n    if (stateTime >= 3) {\r\n      goToGameScreen();\r\n    }\r\n    batch.end();\r\n  };\r\n\r\n  return {\r\n    update,\r\n    destroy() {\r\n      inputHandler.cleanup();\r\n    },\r\n  };\r\n};\r\n","/*\tThis work is licensed under Creative Commons GNU LGPL License.\r\n\r\n\tLicense: http://creativecommons.org/licenses/LGPL/2.1/\r\n   Version: 0.9\r\n\tAuthor:  Stefan Goessner/2006\r\n\tWeb:     http://goessner.net/ \r\n*/\r\nexport default (xml, tab) => {\r\n  var X = {\r\n    toObj: function (xml) {\r\n      var o = {};\r\n      if (xml.nodeType === 1) {\r\n        // element node ..\r\n        if (xml.attributes.length)\r\n          // element with attributes  ..\r\n          for (var i = 0; i < xml.attributes.length; i++)\r\n            o[\"@\" + xml.attributes[i].nodeName] = (\r\n              xml.attributes[i].nodeValue || \"\"\r\n            ).toString();\r\n        if (xml.firstChild) {\r\n          // element has child nodes ..\r\n          var textChild = 0,\r\n            cdataChild = 0,\r\n            hasElementChild = false;\r\n          for (var n = xml.firstChild; n; n = n.nextSibling) {\r\n            if (n.nodeType === 1) hasElementChild = true;\r\n            else if (n.nodeType === 3 && n.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/))\r\n              textChild++;\r\n            // non-whitespace text\r\n            else if (n.nodeType === 4) cdataChild++; // cdata section node\r\n          }\r\n          if (hasElementChild) {\r\n            if (textChild < 2 && cdataChild < 2) {\r\n              // structured element with evtl. a single text or/and cdata node ..\r\n              X.removeWhite(xml);\r\n              for (let n = xml.firstChild; n; n = n.nextSibling) {\r\n                if (n.nodeType === 3)\r\n                  // text node\r\n                  o[\"#text\"] = X.escape(n.nodeValue);\r\n                else if (n.nodeType === 4)\r\n                  // cdata node\r\n                  o[\"#cdata\"] = X.escape(n.nodeValue);\r\n                else if (o[n.nodeName]) {\r\n                  // multiple occurence of element ..\r\n                  if (o[n.nodeName] instanceof Array)\r\n                    o[n.nodeName][o[n.nodeName].length] = X.toObj(n);\r\n                  else o[n.nodeName] = [o[n.nodeName], X.toObj(n)];\r\n                } // first occurence of element..\r\n                else o[n.nodeName] = X.toObj(n);\r\n              }\r\n            } else {\r\n              // mixed content\r\n              if (!xml.attributes.length) o = X.escape(X.innerXml(xml));\r\n              else o[\"#text\"] = X.escape(X.innerXml(xml));\r\n            }\r\n          } else if (textChild) {\r\n            // pure text\r\n            if (!xml.attributes.length) o = X.escape(X.innerXml(xml));\r\n            else o[\"#text\"] = X.escape(X.innerXml(xml));\r\n          } else if (cdataChild) {\r\n            // cdata\r\n            if (cdataChild > 1) o = X.escape(X.innerXml(xml));\r\n            else\r\n              for (let n = xml.firstChild; n; n = n.nextSibling)\r\n                o[\"#cdata\"] = X.escape(n.nodeValue);\r\n          }\r\n        }\r\n        if (!xml.attributes.length && !xml.firstChild) o = null;\r\n      } else if (xml.nodeType === 9) {\r\n        // document.node\r\n        o = X.toObj(xml.documentElement);\r\n      } else alert(\"unhandled node type: \" + xml.nodeType);\r\n      return o;\r\n    },\r\n    toJson: function (o, name, ind) {\r\n      var json = name ? '\"' + name + '\"' : \"\";\r\n      if (o instanceof Array) {\r\n        for (var i = 0, n = o.length; i < n; i++)\r\n          o[i] = X.toJson(o[i], \"\", ind + \"\\t\");\r\n        json +=\r\n          (name ? \":[\" : \"[\") +\r\n          (o.length > 1\r\n            ? \"\\n\" + ind + \"\\t\" + o.join(\",\\n\" + ind + \"\\t\") + \"\\n\" + ind\r\n            : o.join(\"\")) +\r\n          \"]\";\r\n      } else if (o == null) json += (name && \":\") + \"null\";\r\n      else if (typeof o == \"object\") {\r\n        var arr = [];\r\n        for (var m in o) arr[arr.length] = X.toJson(o[m], m, ind + \"\\t\");\r\n        json +=\r\n          (name ? \":{\" : \"{\") +\r\n          (arr.length > 1\r\n            ? \"\\n\" + ind + \"\\t\" + arr.join(\",\\n\" + ind + \"\\t\") + \"\\n\" + ind\r\n            : arr.join(\"\")) +\r\n          \"}\";\r\n      } else if (typeof o == \"string\")\r\n        json += (name && \":\") + '\"' + o.toString() + '\"';\r\n      else json += (name && \":\") + o.toString();\r\n      return json;\r\n    },\r\n    innerXml: function (node) {\r\n      var s = \"\";\r\n      if (\"innerHTML\" in node) s = node.innerHTML;\r\n      else {\r\n        var asXml = function (n) {\r\n          var s = \"\";\r\n          if (n.nodeType === 1) {\r\n            s += \"<\" + n.nodeName;\r\n            for (var i = 0; i < n.attributes.length; i++)\r\n              s +=\r\n                \" \" +\r\n                n.attributes[i].nodeName +\r\n                '=\"' +\r\n                (n.attributes[i].nodeValue || \"\").toString() +\r\n                '\"';\r\n            if (n.firstChild) {\r\n              s += \">\";\r\n              for (var c = n.firstChild; c; c = c.nextSibling) s += asXml(c);\r\n              s += \"</\" + n.nodeName + \">\";\r\n            } else s += \"/>\";\r\n          } else if (n.nodeType === 3) s += n.nodeValue;\r\n          else if (n.nodeType === 4) s += \"<![CDATA[\" + n.nodeValue + \"]]>\";\r\n          return s;\r\n        };\r\n        for (var c = node.firstChild; c; c = c.nextSibling) s += asXml(c);\r\n      }\r\n      return s;\r\n    },\r\n    escape: function (txt) {\r\n      return txt\r\n        .replace(/[\\\\]/g, \"\\\\\\\\\")\r\n        .replace(/[\\\\\"]/g, '\\\\\"')\r\n        .replace(/[\\n]/g, \"\\\\n\")\r\n        .replace(/[\\r]/g, \"\\\\r\");\r\n    },\r\n    removeWhite: function (e) {\r\n      e.normalize();\r\n      for (var n = e.firstChild; n; ) {\r\n        if (n.nodeType === 3) {\r\n          // text node\r\n          if (!n.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/)) {\r\n            // pure whitespace text node\r\n            var nxt = n.nextSibling;\r\n            e.removeChild(n);\r\n            n = nxt;\r\n          } else n = n.nextSibling;\r\n        } else if (n.nodeType === 1) {\r\n          // element node\r\n          X.removeWhite(n);\r\n          n = n.nextSibling;\r\n        } // any other node\r\n        else n = n.nextSibling;\r\n      }\r\n      return e;\r\n    },\r\n  };\r\n  if (xml.nodeType === 9)\r\n    // document node\r\n    xml = xml.documentElement;\r\n  var json = X.toJson(X.toObj(X.removeWhite(xml)), xml.nodeName, \"\\t\");\r\n  return (\r\n    \"{\\n\" +\r\n    tab +\r\n    (tab ? json.replace(/\\t/g, tab) : json.replace(/\\t|\\n/g, \"\")) +\r\n    \"\\n}\"\r\n  );\r\n};\r\n","import xml2json from \"./xml2json\";\r\nimport { Data, Pose } from \"spriter-lib\";\r\n\r\nexport default async (packFileUrl) => {\r\n  const regionNames = {};\r\n  let spriter_data = null;\r\n  let spriter_json;\r\n  const packFileContent = await fetch(packFileUrl).then((res) => res.text());\r\n  let match = packFileUrl.match(/.scml$/i);\r\n  if (match !== null) {\r\n    let parser = new DOMParser();\r\n    let xml_text = packFileContent.replace(/&quot;/g, '\"');\r\n    let xml = parser.parseFromString(xml_text, \"text/xml\");\r\n    let json_text = xml2json(xml, \"\\t\");\r\n    json_text = json_text.replace(/\"@(.*)\":/g, '\"$1\":');\r\n    let json = JSON.parse(json_text);\r\n    spriter_json = json.spriter_data;\r\n  } else {\r\n    spriter_json = JSON.parse(packFileContent);\r\n  }\r\n  spriter_data = new Data().load(spriter_json);\r\n\r\n  spriter_data.folder_array.forEach((folder, index) => {\r\n    regionNames[index] = {};\r\n    folder.file_array.forEach((file, fileIndex) => {\r\n      regionNames[folder.id][fileIndex] = file.name;\r\n    });\r\n  });\r\n  const pose = new Pose(spriter_data);\r\n\r\n  return { regionNames, pose, data: spriter_data, rawData: spriter_json };\r\n};\r\n","export default class TextureRegion {\r\n  static splitTexture(texture, cols, rows) {\r\n    const { width, height } = texture;\r\n    const regionWidth = width / cols;\r\n    const regionHeight = height / rows;\r\n    const regions = [];\r\n\r\n    for (let x = 0; x < cols; x++) {\r\n      for (let y = 0; y < rows; y++) {\r\n        regions.push(\r\n          new TextureRegion(\r\n            texture,\r\n            x * regionWidth,\r\n            y * regionHeight,\r\n            regionWidth,\r\n            regionHeight,\r\n            {}\r\n          )\r\n        );\r\n      }\r\n    }\r\n\r\n    return regions;\r\n  }\r\n  constructor(\r\n    tex,\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n    originX,\r\n    originY,\r\n    extraData,\r\n    invTexWidth,\r\n    invTexHeight\r\n  ) {\r\n    if (!invTexWidth || !invTexHeight) {\r\n      invTexWidth = 1 / tex.width;\r\n      invTexHeight = 1 / tex.height;\r\n    }\r\n    const u = x * invTexWidth;\r\n    const v = y * invTexHeight;\r\n    const u2 = (x + width) * invTexWidth;\r\n    const v2 = (y + height) * invTexHeight;\r\n    this.rotated = false;\r\n    this.texture = tex;\r\n    this.x = x;\r\n    this.y = y;\r\n    this.originX = originX;\r\n    this.originY = originY;\r\n    this.width = width;\r\n    this.height = height;\r\n    this.u = u;\r\n    this.v = v;\r\n    this.u2 = u2;\r\n    this.v2 = v2;\r\n    for (let key in extraData) {\r\n      this[key] = extraData[key];\r\n    }\r\n  }\r\n\r\n  draw(\r\n    batch,\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n    originX = 0,\r\n    originY = 0,\r\n    rotation = 0,\r\n    scaleX = 1,\r\n    scaleY = 1\r\n  ) {\r\n    batch.draw(\r\n      this.texture,\r\n      x,\r\n      y,\r\n      width,\r\n      height,\r\n      this.rotated,\r\n      originX,\r\n      originY,\r\n      rotation,\r\n      scaleX,\r\n      scaleY,\r\n      this.u,\r\n      this.v,\r\n      this.u2,\r\n      this.v2\r\n    );\r\n  }\r\n}\r\n","import { loadTexture } from \"gdxjs\";\r\nimport TextureRegion from \"./textureRegion\";\r\nfunction concatAndResolveUrl(url, concat) {\r\n  let url1 = url.split(\"/\");\r\n  let url2 = concat.split(\"/\");\r\n  let url3 = [];\r\n\r\n  for (let i = 0, l = url1.length; i < l; i++) {\r\n    if (url1[i] === \"..\") {\r\n      url3.pop();\r\n    } else if (url1[i] === \".\") {\r\n      continue;\r\n    } else {\r\n      url3.push(url1[i]);\r\n    }\r\n  }\r\n\r\n  for (let i = 0, l = url2.length; i < l; i++) {\r\n    if (url2[i] === \"..\") {\r\n      url3.pop();\r\n    } else if (url2[i] === \".\") {\r\n      continue;\r\n    } else {\r\n      url3.push(url2[i]);\r\n    }\r\n  }\r\n  return url3.join(\"/\");\r\n}\r\nconst loadUrl = async (gl, packFileUrl, textureOptions, textureRegions) => {\r\n  const packFileContent = await fetch(packFileUrl).then((res) => res.text());\r\n  const regions = [];\r\n  const sites = [];\r\n  const obj = JSON.parse(packFileContent);\r\n  const meta = obj.meta;\r\n  let name = Object.getOwnPropertyNames(obj.frames);\r\n  const framesArray = Object.keys(obj.frames).map((i) => obj.frames[i]);\r\n  const file = concatAndResolveUrl(packFileUrl, `../${meta.image}`);\r\n  for (let i = 0; i < framesArray.length; i++) {\r\n    const frame = framesArray[i];\r\n    let w = frame.frame.w,\r\n      h = frame.frame.h;\r\n    const site = {\r\n      // const frame: any = tps_json.frames[key],\r\n      // const site: Site = (data.sites[key] = new Site());\r\n      x: frame.frame.x,\r\n      y: frame.frame.y,\r\n      w: frame.frame.w,\r\n      h: frame.frame.h,\r\n      rotate: frame.rotated ? 1 : 0, // 90 degrees\r\n      offset_x: (frame.spriteSourceSize && frame.spriteSourceSize.x) || 0,\r\n      offset_y: (frame.spriteSourceSize && frame.spriteSourceSize.y) || 0,\r\n      original_w: (frame.sourceSize && frame.sourceSize.w) || w,\r\n      original_h: (frame.sourceSize && frame.sourceSize.h) || h,\r\n    };\r\n    sites.push(site);\r\n    const region = {\r\n      id: i,\r\n      name: name[i],\r\n      frame: frame.frame,\r\n      rotated: frame.rotated === \"true\",\r\n      sourceSize: frame.sourceSize,\r\n      spriteSourceSize: frame.spriteSourceSize,\r\n      trimmed: frame.trimmed,\r\n      app: meta.app,\r\n      format: meta.format,\r\n      main_texture: meta.image,\r\n      scale: meta.scale,\r\n      size: meta.size,\r\n      version: meta.version,\r\n      site: site,\r\n      meta: meta,\r\n    };\r\n    regions.push(region);\r\n  }\r\n  const tex = await loadTexture(gl, file, textureOptions);\r\n  for (const region of regions) {\r\n    const x = region.frame.x;\r\n    const y = region.frame.y;\r\n    const w = region.rotated ? region.frame.h : region.frame.w;\r\n    const h = region.rotated ? region.frame.w : region.frame.h;\r\n    const originX = region.rotated ? region.sourceSize.h : region.sourceSize.w;\r\n    const originY = region.rotated ? region.sourceSize.w : region.sourceSize.h;\r\n    const extraData = region;\r\n    const invTextWidth = 1 / region.size.w;\r\n    const invTextHeight = 1 / region.size.h;\r\n    textureRegions.push(\r\n      new TextureRegion(\r\n        tex,\r\n        x,\r\n        y,\r\n        w,\r\n        h,\r\n        originX,\r\n        originY,\r\n        extraData,\r\n        invTextWidth,\r\n        invTextHeight\r\n      )\r\n    );\r\n  }\r\n  return textureRegions;\r\n};\r\nexport default async (gl, listPackFileUrl, textureOptions) => {\r\n  let textureRegions = [];\r\n  if (Array.isArray(listPackFileUrl)) {\r\n    for (const packFileUrl of listPackFileUrl) {\r\n      textureRegions = await loadUrl(\r\n        gl,\r\n        packFileUrl,\r\n        textureOptions,\r\n        textureRegions\r\n      );\r\n    }\r\n  } else {\r\n    textureRegions = await loadUrl(\r\n      gl,\r\n      listPackFileUrl,\r\n      textureOptions,\r\n      textureRegions\r\n    );\r\n  }\r\n  return {\r\n    getRegions() {\r\n      return textureRegions;\r\n    },\r\n    findRegion(name) {\r\n      for (let i = 0; i < textureRegions.length; i++) {\r\n        if (textureRegions[i].name === name) {\r\n          return textureRegions[i];\r\n        }\r\n      }\r\n    },\r\n  };\r\n};\r\n","import loadSCML from \"./components/loadSCML\";\r\nimport loadJsonAtlas from \"./components/loadJsonAtlas\";\r\nimport nudged from \"nudged\";\r\nimport { mat4, vec3 } from \"gl-matrix\";\r\n\r\nfunction concatAndResolveUrl(url, concat) {\r\n  let url1 = url.split(\"/\");\r\n  let url2 = concat.split(\"/\");\r\n  let url3 = [];\r\n\r\n  for (let i = 0, l = url1.length; i < l; i++) {\r\n    if (url1[i] === \"..\") {\r\n      url3.pop();\r\n    } else {\r\n      url3.push(url1[i]);\r\n    }\r\n  }\r\n\r\n  for (let i = 0, l = url2.length; i < l; i++) {\r\n    if (url2[i] === \"..\") {\r\n      url3.pop();\r\n    } else if (url2[i] === \".\") {\r\n      continue;\r\n    } else {\r\n      url3.push(url2[i]);\r\n    }\r\n  }\r\n\r\n  return url3.join(\"/\");\r\n}\r\n\r\nexport default async (gl, scmlUrl, rectName) => {\r\n  const { regionNames, pose, data, rawData } = await loadSCML(scmlUrl);\r\n  const atlasInfos = rawData.atlas.i;\r\n\r\n  const transformMatrix = mat4.create();\r\n  const vertices = new Float32Array(20);\r\n  const arr1 = [];\r\n  const arr2 = [];\r\n  const arr3 = [];\r\n  const arr4 = [];\r\n  let xy1 = [];\r\n  let xy2 = [];\r\n  let xy3 = [];\r\n  let xy4 = [];\r\n\r\n  const atlas = await loadJsonAtlas(\r\n    gl,\r\n    atlasInfos.map((info) => concatAndResolveUrl(scmlUrl, `../${info.name}`))\r\n  );\r\n\r\n  let rectObject;\r\n\r\n  const setArr = (arr, v1, v2, v3, v4, v5) => {\r\n    arr.length = 0;\r\n    arr.push(v1, v2, v3, v4, v5);\r\n  };\r\n\r\n  const generateVertices = (\r\n    region,\r\n    position,\r\n    rotation,\r\n    scale,\r\n    affine,\r\n    color\r\n  ) => {\r\n    if (region.rotated) {\r\n      setArr(\r\n        arr1,\r\n        position.x - region.height / 2,\r\n        position.y - region.width / 2,\r\n        color,\r\n        region.u,\r\n        region.v\r\n      );\r\n      setArr(\r\n        arr2,\r\n        position.x + region.height / 2,\r\n        position.y - region.width / 2,\r\n        color,\r\n        region.u,\r\n        region.v2\r\n      );\r\n\r\n      setArr(\r\n        arr3,\r\n        position.x + region.height / 2,\r\n        position.y + region.width / 2,\r\n        color,\r\n        region.u2,\r\n        region.v2\r\n      );\r\n      setArr(\r\n        arr4,\r\n        position.x - region.height / 2,\r\n        position.y + region.width / 2,\r\n        color,\r\n        region.u2,\r\n        region.v\r\n      );\r\n    } else {\r\n      setArr(\r\n        arr1,\r\n        position.x - region.width / 2,\r\n        position.y - region.height / 2,\r\n        color,\r\n        region.u,\r\n        region.v2\r\n      );\r\n      setArr(\r\n        arr2,\r\n        position.x + region.width / 2,\r\n        position.y - region.height / 2,\r\n        color,\r\n        region.u2,\r\n        region.v2\r\n      );\r\n      setArr(\r\n        arr3,\r\n        position.x + region.width / 2,\r\n        position.y + region.height / 2,\r\n        color,\r\n        region.u2,\r\n        region.v\r\n      );\r\n      setArr(\r\n        arr4,\r\n        position.x - region.width / 2,\r\n        position.y + region.height / 2,\r\n        color,\r\n        region.u,\r\n        region.v\r\n      );\r\n    }\r\n\r\n    mat4.identity(transformMatrix);\r\n    mat4.translate(transformMatrix, transformMatrix, [\r\n      position.x,\r\n      position.y,\r\n      0,\r\n    ]);\r\n    mat4.rotateZ(transformMatrix, transformMatrix, rotation.rad);\r\n    mat4.scale(transformMatrix, transformMatrix, [scale.x, scale.y, 1]);\r\n    mat4.translate(transformMatrix, transformMatrix, [\r\n      -position.x,\r\n      -position.y,\r\n      0,\r\n    ]);\r\n\r\n    setArr(xy1, arr1[0], arr1[1], 0);\r\n    setArr(xy2, arr2[0], arr2[1], 0);\r\n    setArr(xy3, arr3[0], arr3[1], 0);\r\n    setArr(xy4, arr4[0], arr4[1], 0);\r\n\r\n    vec3.transformMat4(xy1, xy1, transformMatrix);\r\n    vec3.transformMat4(xy2, xy2, transformMatrix);\r\n    vec3.transformMat4(xy3, xy3, transformMatrix);\r\n    vec3.transformMat4(xy4, xy4, transformMatrix);\r\n\r\n    if (affine) {\r\n      xy1 = affine.transform(xy1);\r\n      xy2 = affine.transform(xy2);\r\n      xy3 = affine.transform(xy3);\r\n      xy4 = affine.transform(xy4);\r\n    }\r\n\r\n    vertices[0] = xy1[0];\r\n    vertices[1] = xy1[1];\r\n    vertices[2] = arr1[2];\r\n    vertices[3] = arr1[3];\r\n    vertices[4] = arr1[4];\r\n    vertices[5] = xy2[0];\r\n    vertices[6] = xy2[1];\r\n    vertices[7] = arr2[2];\r\n    vertices[8] = arr2[3];\r\n    vertices[9] = arr2[4];\r\n    vertices[10] = xy3[0];\r\n    vertices[11] = xy3[1];\r\n    vertices[12] = arr3[2];\r\n    vertices[13] = arr3[3];\r\n    vertices[14] = arr3[4];\r\n    vertices[15] = xy4[0];\r\n    vertices[16] = xy4[1];\r\n    vertices[17] = arr4[2];\r\n    vertices[18] = arr4[3];\r\n    vertices[19] = arr4[4];\r\n  };\r\n\r\n  let rect;\r\n  const domain = [\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n  ];\r\n  const range = [\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n  ];\r\n\r\n  let prevX, prevY, prevW, prevH, affine;\r\n\r\n  return {\r\n    getAnim() {\r\n      return pose.getAnim();\r\n    },\r\n    getInfos() {\r\n      return { regionNames, pose, data, rawData };\r\n    },\r\n    getAspect() {\r\n      if (!rectObject) {\r\n        return 1;\r\n      }\r\n      return rectObject.w / rectObject.h;\r\n    },\r\n    update(delta) {\r\n      pose.update(delta);\r\n      pose.strike();\r\n    },\r\n    setEntity(entityKey) {\r\n      pose.setEntity(entityKey);\r\n      const entity = pose.data.entity_map[entityKey];\r\n      rectObject = entity.obj_info_map[rectName];\r\n      affine = null;\r\n    },\r\n    setAnim(anim) {\r\n      pose.setAnim(anim);\r\n      affine = null;\r\n    },\r\n    draw(batch, x, y, width, height) {\r\n      if (!rect) {\r\n        rect = pose.object_array.find((obj) => obj.name === rectName);\r\n\r\n        const px = rect.world_space.position.x;\r\n        const py = rect.world_space.position.y;\r\n        const pw = rectObject.w * rect.world_space.scale.x;\r\n        const ph = rectObject.h * rect.world_space.scale.y;\r\n\r\n        setArr(domain[0], px - pw / 2, py - ph / 2);\r\n        setArr(domain[1], px + pw / 2, py - ph / 2);\r\n        setArr(domain[2], px - pw / 2, py + ph / 2);\r\n      }\r\n\r\n      if (\r\n        !affine ||\r\n        x !== prevX ||\r\n        y !== prevY ||\r\n        width !== prevW ||\r\n        height !== prevH\r\n      ) {\r\n        setArr(range[0], x - width / 2, y - height / 2);\r\n        setArr(range[1], x + width / 2, y - height / 2);\r\n        setArr(range[2], x - width / 2, y + height / 2);\r\n        prevX = x;\r\n        prevY = y;\r\n        prevW = width;\r\n        prevH = height;\r\n        affine = nudged.estimate(\"TS\", domain, range);\r\n      }\r\n\r\n      pose.object_array.forEach((obj) => {\r\n        if (obj.type !== \"sprite\") return;\r\n        // !this.printed && (console.log(obj) || (this.printed = true));\r\n        // Space.combine(obj.world_space, obj.local_space, obj.world_space);\r\n        const { position, rotation, scale } = obj.world_space;\r\n        if (\r\n          !regionNames[obj.folder_index] ||\r\n          !regionNames[obj.folder_index][obj.file_index]\r\n        )\r\n          return;\r\n        const region = atlas.findRegion(\r\n          regionNames[obj.folder_index][obj.file_index]\r\n        );\r\n        if (!region) return;\r\n        generateVertices(\r\n          region,\r\n          position,\r\n          rotation,\r\n          scale,\r\n          affine,\r\n          batch.color\r\n        );\r\n        batch.drawVertices(region.texture, vertices, 0);\r\n      });\r\n    },\r\n  };\r\n};\r\n","import \"./index.css\";\n\nimport {\n  createBatch,\n  createGameLoop,\n  loadAtlas,\n  loadTexture,\n  createViewport,\n} from \"gdxjs\";\nimport createWhiteText from \"gl-white-texture\";\nimport createRenderStartScreenSystem from \"./screen/StartScreen\";\n// import loadSpriterAnimation from \"./loadSpriterAnimation\";\nimport loadSpriter from \"./loadSpriter\";\nimport { Howl } from \"howler\";\n\nconst init = async () => {\n  const canvas = document.getElementById(\"main\");\n\n  const pixelRatio = window.devicePixelRatio;\n  // const [width, height] = resizeCanvas(canvas, pixelRatio);\n\n  const [width, height] = [47, 100];\n  // const [width, height] = [46 * 10, 100 * 10];\n  const viewport = createViewport(canvas, width, height);\n  const gl = viewport.getContext();\n  const camera = viewport.getCamera();\n\n  const batch = createBatch(gl);\n  const whiteTex = createWhiteText(gl);\n\n  const sound = new Howl({\n    src: [\"ghen_covy.mp3\"],\n  });\n\n  const Game = {\n    completePercentage: 0,\n    viewport,\n    canvas,\n    width,\n    height,\n    gl,\n    batch,\n    whiteTex,\n    camera,\n    pixelRatio,\n    sound,\n    setCurrentScreen(screen) {\n      if (Game.currentScreen) {\n        Game.currentScreen.destroy();\n      }\n      Game.currentScreen = screen;\n    },\n  };\n\n  const spriter = await loadSpriter(\n    gl,\n    \"./spriter_animations/hands.scml\",\n    \"box_000\"\n  );\n  Game.spriter = spriter;\n\n  const auditionAtlas = await loadAtlas(gl, \"./assets/audition_asset.atlas\");\n  const finishAtlas = await loadAtlas(\n    gl,\n    \"./assets/audition-assets_mark.atlas\"\n  );\n  const startEndAtlas = await loadAtlas(gl, \"./assets/start_end.atlas\");\n  const curtain = await loadTexture(gl, \"./assets/curtain.png\");\n\n  const assets = { auditionAtlas, finishAtlas, startEndAtlas, curtain };\n  Game.assets = assets;\n\n  Game.setCurrentScreen(await createRenderStartScreenSystem(Game));\n\n  gl.clearColor(0, 0, 0, 0);\n  const update = (delta) => {\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    if (Game.currentScreen) {\n      Game.currentScreen.update(delta);\n    }\n  };\n\n  createGameLoop(update);\n};\n\ninit();\n"],"sourceRoot":""}